# スケジュール画像作成アプリ - 使い方ガイド

キャストのシフトスケジュールを入力し、PNG画像として書き出すWebアプリです。
ブラウザ上で完結し、サーバーへのアップロードは一切ありません。データはすべてブラウザのローカルストレージに自動保存されます。

## 起動方法

```bash
npm i
npm run dev
```

ブラウザで http://localhost:3000 を開いてください。

---

## 画面構成

```
┌─────────────────────┬─────────────────────┐
│   左側：編集エリア    │   右側：プレビュー    │
│                     │                     │
│  スケジュール編集 タブ │  タイムライン / 表形式 │
│  キャストマスター タブ │                     │
└─────────────────────┴─────────────────────┘
```

---

## STEP 1｜キャストマスターを登録する

「キャストマスター」タブを開きます。
ここに登録した名前・画像・色が、スケジュール画像の生成に使われます。

### 方法A：画像ZIPをまとめて読み込む（推奨）

1. キャストの顔写真を `キャスト名.png`（または `.jpg` `.webp`）というファイル名でフォルダに用意する
2. そのフォルダをZIPに圧縮する
3. 「ZIPファイルを選択」ボタンでZIPをアップロードする
4. ファイル名（拡張子除く）がキャスト名として自動登録される

```
例：ZIPの中身
  田中花子.png
  山田太郎.jpg
  東雲鈴弥.webp
```

> macOSで圧縮したZIPの `__MACOSX` フォルダ内のファイルは自動的に無視されます。

### 方法B：CSVで一括インポートする

以下の形式のCSVファイルを用意して「CSVファイルを選択」でインポートします。

```
田中花子,#ff6aa2
山田太郎,#6ab4ff
東雲鈴弥,
```

- 形式：`キャスト名,カラーコード`（1行1人）
- カラーコードは省略可能（省略時はデフォルト色）
- 登録済みのキャストと名前が一致する場合は色のみ更新されます

登録済みキャストは「CSV書き出し」ボタンでバックアップできます。

### 方法C：手動で1人ずつ追加する

「手動追加」欄にキャスト名とカラーコードを入力して「追加」ボタンを押します。
画像はZIPアップロードで後から追加できます。

---

## STEP 2｜ランクを設定する

「当月のランクリスト」欄に、各ランクに該当するキャスト名を1行1人で入力し、「ランクリストを反映」を押します。

| ランク | 表示 |
|--------|------|
| ゴールド | 金色バッジ |
| シルバー | 銀色バッジ |
| ブロンズ | 銅色バッジ |
| （未設定） | バッジなし |

ランクはスケジュール画像上の表示順・装飾に影響します。

---

## STEP 3｜スケジュールを入力する

「スケジュール編集」タブを使います。入力方法は3種類あります。

### 入力方法①：週一括入力（複数日まとめて入力）

1週間分のスケジュールを一度に入力できます。

**書式：**
```
## YYYY/MM/DD
【時間】キャスト名 キャスト名 ...

## YYYY/MM/DD
【時間】キャスト名 ...
```

**入力例：**
```
## 2026/02/09
【11:00】 田中花子 山田太郎
【12:00】 東雲鈴弥 美琴
【18:00】 田中花子

## 2026/02/10
【11:00】 山田太郎
【14:00】 美琴 東雲鈴弥
```

「週をパースして反映」ボタンを押すと複数日のスケジュールが一括登録されます。
右側プレビューの「◀ 前日 / 翌日 ▶」ボタンで日付を切り替えて確認できます。

---

### 入力方法②：1日分一括入力

現在表示中の日付に、1日分のスケジュールをまとめて入力します。

**書式：**
```
【時間】キャスト名 キャスト名 【時間】キャスト名 ...
```

**入力例：**
```
【11:00】 田中花子 山田太郎 【12:00】 東雲鈴弥 【18:00】 田中花子
```

- 1行でも複数行でも可
- 記入していない時間帯の既存データは変更されません
- 「一括反映」ボタンで反映します

---

### 入力方法③：時間帯ごとに個別入力

「時間帯ごとのキャスト」セクションで時間帯をクリックして展開し、
キャスト名をカンマまたは改行区切りで入力して「一括追加」を押します。

---

## STEP 4｜ロゴ画像を設定する（任意）

「スケジュール編集」タブ下部の「ロゴ画像」欄から画像ファイルをアップロードすると、
生成されるタイムライン画像にロゴが表示されます。

---

## STEP 5｜プレビューを確認してPNG書き出し

### プレビューモードの切り替え

右側パネル右上のタブで切り替えます。

| モード | 説明 |
|--------|------|
| 一覧（タイムライン） | 時間軸上にキャストのアイコンを並べた形式 |
| 表形式 | キャストと時間帯をクロス表で表示 |

タイムラインモードでは **16:9 / 1:1** のアスペクト比を選択できます。

### PNG書き出し

| ボタン | 動作 |
|--------|------|
| 右上「PNG書き出し」 | 現在表示中の1日分を1枚のPNGで保存 |
| 「週一括PNG出力（N日分）」 | 週入力で反映した全日付を16:9・1:1の両方でZIPにまとめて保存 |

---

## データの保存について

すべてのデータはブラウザの **localStorage** に自動保存されます。
ページを閉じても次回開いたときに復元されます。

| 保存されるデータ |
|----------------|
| キャストマスター（名前・画像・色） |
| ランクリスト（ゴールド・シルバー・ブロンズ） |
| スケジュール（日付ごとの時間帯・キャスト） |
| ロゴ画像 |

> ブラウザのキャッシュをクリアするとデータが消えます。
> 定期的にキャストマスターを「CSV書き出し」でバックアップすることをおすすめします。

---

## キャスト名の正規化ルール

スケジュール入力時のキャスト名は自動的に正規化されてマスターと照合されます。
以下の違いは同一人物として扱われます。

- 全角・半角スペースの違い
- 先頭の記号（`_` `-` `・` `.` など）の有無
- Unicode正規化の違い（濁点の合成方式など）

---

## よくある問題

| 症状 | 対処法 |
|------|--------|
| 画像が表示されない | キャストマスターにZIPで画像を登録してください |
| キャスト名が一致しない | 名前の表記ゆれを確認し、マスター側の名前に統一してください |
| 保存容量エラーが出る | 画像データが大きすぎます。画像を圧縮するか不要なキャストを削除してください |
| 入力しても反映されない | ブラウザを再読み込みして再度試してください |
